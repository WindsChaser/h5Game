!function(e){var t={};function a(o){if(t[o])return t[o].exports;var d=t[o]={i:o,l:!1,exports:{}};return e[o].call(d.exports,d,d.exports,a),d.l=!0,d.exports}a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var d in e)a.d(o,d,function(t){return e[t]}.bind(null,d));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";a.r(t);var o=Phaser.KeyCode;var d=function(e){return{preload:()=>{e.load.baseURL="res/",e.load.image("start-1","background/start-1.png"),e.load.image("start-2","background/start-2.png"),e.load.spritesheet("loading-text","background/loading-text.png",256,64,2),e.load.atlasJSONArray("loading-moon","background/moon.png","background/moon.json")},create:()=>{e.world.alpha=0,e.add.tween(e.world).to({alpha:1},2e3,Phaser.Easing.Default,!0),e.add.image(0,0,"start-1"),e.add.image(1024,0,"start-2");let t=e.time.create(!1);t.start(),t.loop(500,()=>{let a=e.add.image(1e3+400*(Math.random()-.5),600+100*Math.random(),"loading-moon");a.scale=new Phaser.Point(.8,.8),a.alpha=0,e.add.tween(a).to({alpha:.5},1e3,Phaser.Easing.Default,!0),a.animations.add("rotate",null,60,!0),a.animations.play("rotate"),a.frame=Math.round(240*Math.random());let o=e.add.tween(a).to({y:100*Math.random()+850},4e3,Phaser.Easing.Default,!0);t.add(3e3,()=>{e.add.tween(a).to({alpha:0},1e3,Phaser.Easing.Default,!0).onComplete.add(()=>{o.manager.remove(o),a.destroy()})})});let a=e.add.image(900,770,"loading-text",1);a.alpha=.3,e.add.tween(a).to({alpha:.7},300,Phaser.Easing.Default,!0,0,-1,!0);let d=e.add.image(850,740,"loading-text",0);d.alpha=.3,e.add.tween(d).to({alpha:.7},300,Phaser.Easing.Default,!0,500,-1,!0);let n=e.input.keyboard.addKeys({z:o.Z});e.input.keyboard.addKeyCapture(o.Z),n.z.onDown.addOnce(()=>{e.add.tween(e.world).to({alpha:0},500,Phaser.Easing.Default,!0).onComplete.add(()=>{e.state.start("play",!0,!0)})})},update:()=>{},render:()=>{}}};window.keypress.Listener;let n=DLL.DoublyLinkedList;gamecore.Pooled;class i{get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get value(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}set value(e){let t=this.value;0!=t&&(this._x*=e/t,this._y*=e/t)}constructor(e,t){this._x=e,this._y=t}reverse(){return this._x*=-1,this._y*=-1,this}reverseX(){return this._x*=-1,this}reverseY(){return this._y*=-1,this}add(e){return this._x+=e._x,this._y+=e._y,this}clone(){return new i(this._x,this._y)}}class s{constructor(e,t,a){this._linkedList=new n,this._create=e,this._release=t,this._init=a}get(...e){if(this._linkedList.size()>0){let t=this._linkedList.head(),a=t.data;return this._init(a,...e),t.remove(),a}{let t=this._create();return this._init(t,...e),t.release=(()=>{this._release(t),this._linkedList.append(t)}),t}}size(){return this._linkedList.size()}}var r=Phaser.KeyCode;var l=function(e){let t,a,o,d,n,l,u,p,y,h,c,b=0;return{preload:()=>{e.load.baseURL="res/",e.load.spritesheet("role","texture/role/role_01.png",32,48),e.load.spritesheet("sloweffect","texture/sloweffect.png",64,64),e.load.spritesheet("enemy","texture/enemy.png",64,64),e.load.spritesheet("bullet-enemy","texture/bullet.png",16,16),e.load.image("bullet-role","texture/role/role_05.png"),e.load.image("st01a","texture/st01a.png"),e.load.audio("bgm","sound/bgm.mp3")},create:()=>{let g;e.add.tween(e.world).to({alpha:1},1e3,Phaser.Easing.Default,!0),e.stage.backgroundColor=0,e.physics.startSystem(Phaser.Physics.P2JS),e.physics.p2.restitution=1,l=e.physics.p2.createCollisionGroup(),d=e.physics.p2.createCollisionGroup(),u=e.physics.p2.createCollisionGroup(),n=e.physics.p2.createCollisionGroup(),e.physics.p2.updateBoundsCollisionGroup(!0),(c=e.time.create(!1)).start(),(a=e.add.tileSprite(0,0,e.width,e.height,"st01a")).autoScroll(0,90),function(){(o=e.add.sprite(e.width/2,e.height-100,"role")).scale=new Phaser.Point(2,2),e.physics.p2.enable(o,!0),o.body.setCircle(6),o.body.mass=16,o.body.motionState=Phaser.Physics.P2.Body.DYNAMIC,o.body.fixedRotation=!0,o.body.setCollisionGroup(l),o.body.collides([n]),o.body.collideWorldBounds=!0,o.body.onBeginContact.add(()=>{},this),e.camera.follow(o),(y=o.addChild(e.make.sprite(0,0,"sloweffect"))).anchor=new Phaser.Point(.5,.5),e.add.tween(y).to({angle:360},4e3,Phaser.Easing.Default,!0,0,-1),y.fadeOut=e.add.tween(y).to({alpha:0},100,Phaser.Easing.Default,!1,0),y.fadeOut.onComplete.add(()=>y.alpha=0),y.fadeIn=e.add.tween(y).to({alpha:1},100,Phaser.Easing.Default,!1,0),y.fadeIn.onComplete.add(()=>y.alpha=1),o.animations.add("stand",[0,1,2,3,4,5,6,7],8,!0),o.animations.add("left",[11,12,13,14,15],16,!0),o.animations.add("beginLeft",[8,9,10],16,!1).onComplete.add(()=>{o.animations.play("left")},this),o.animations.add("right",[19,20,21,22,23],16,!0),o.animations.add("beginRight",[16,17,18],16,!1).onComplete.add(()=>{o.animations.play("right")},this)}(),p=new s(()=>{let t=e.add.sprite(0,0,"bullet-role");return e.physics.p2.enable(t,!1),t.body.setZeroDamping(),t.body.setCollisionGroup(u),t.body.collides([d]),t.body.collideWorldBounds=!1,t.body.onBeginContact.add(()=>{t.kill(),t.release()},this),t.checkWorldBounds=!0,t.events.onOutOfBounds.add(e=>{e.kill(),e.release()}),t},e=>{},(e,t,a,o,d)=>{e.reset(0,0),e.body.angle=-90,e.body.x=t,e.body.y=a,e.body.velocity.x=o,e.body.velocity.y=d}),c.repeat(0,20,()=>{!function(t,a){let s=e.add.sprite(t||200,a||200,"enemy");s.animations.add("stand",[0,1,2,3,4],10,!0),s.animations.play("stand"),e.physics.p2.enable(s,!1),s.body.static=!0,s.body.setCollisionGroup(d),s.body.collides([u]),s.body.collideWorldBounds=!0,s.health=10;let r=c.loop(100,()=>{let t=e.add.sprite(s.body.x,s.body.y,"bullet-enemy",162);b++,e.physics.p2.enable(t,!1),t.body.setCircle(8),t.body.setZeroDamping();let a=e.add.tween(t.body).to({angle:359},4e3,Phaser.Easing.Default,!0,0,-1);t.body.setCollisionGroup(n),t.body.collides([l]),t.body.collideWorldBounds=!1,t.body.onBeginContact.add(()=>{t.kill(),e.camera.shake(.01,500,!0)},this),t.checkWorldBounds=!0,t.events.onOutOfBounds.add(()=>{t.kill()},this),t.events.onKilled.add(()=>{e.tweens.remove(a),t.destroy(),b--});let d=new i(o.body.x-t.body.x,o.body.y-t.body.y);d.value=400,t.body.velocity.x=d.x,t.body.velocity.y=d.y});s.body.onBeginContact.add(()=>{s.damage(1)}),s.events.onKilled.add(()=>{c.remove(r),s.destroy()})}(800*Math.random(),400*Math.random())}),h=e.input.keyboard.addKeys({left:r.LEFT,right:r.RIGHT,up:r.UP,down:r.DOWN,shift:r.SHIFT,z:r.Z,space:r.SPACEBAR}),e.input.keyboard.addKeyCapture(r.LEFT),e.input.keyboard.addKeyCapture(r.RIGHT),e.input.keyboard.addKeyCapture(r.UP),e.input.keyboard.addKeyCapture(r.DOWN),e.input.keyboard.addKeyCapture(r.SHIFT),e.input.keyboard.addKeyCapture(r.Z),e.input.keyboard.addKeyCapture(r.SPACEBAR),c.loop(1e3,()=>{},this),h.z.onDown.add(()=>{p.get(o.x,o.y,0,-1200),g=c.loop(50,()=>{p.get(o.x,o.y,0,-1200)})}),h.z.onUp.add(()=>{c.remove(g)}),e.time.advancedTiming=!0,(t=e.add.text(0,0,"",{fill:"#ff0000",fontSize:30})).fixedToCamera=!0,e.add.audio("bgm").onDecoded.add(e=>{e.play()})},update:()=>{!function(){h.left.justDown?o.animations.play("beginLeft"):h.right.justDown?o.animations.play("beginRight"):h.left.isDown||h.right.isDown||o.animations.play("stand"),h.shift.justDown?y.fadeIn.start():h.shift.justUp?y.fadeOut.start():h.shift.isDown?y.alpha=1:y.alpha=0;let e=500*(h.shift.isDown?.4:1),t=new i(0,0);h.down.isDown?t.y=1:h.up.isDown&&(t.y=-1),h.right.isDown?t.x=1:h.left.isDown&&(t.x=-1),t.value=e,o.body.velocity.x=t.x,o.body.velocity.y=t.y}()},render:()=>{t.text="Fps:"+e.time.fps,t.bringToTop(),console.log(b)}}};let u=new Phaser.Game(1280,960,Phaser.AUTO);u.state.add("start",d(u)),u.state.add("play",l(u)),u.state.start("start")}]);